# Top-K High Utility Sequential Pattern Mining (TKUSP)

This project implements the **TKUSP** algorithm and its enhanced variants for mining the top-k high utility sequential patterns from transaction databases using Cross-Entropy (CE) optimization.

## Overview

The goal is to discover the $k$ sequential patterns that yield the highest utility (e.g., profit) in a sequence database. The algorithms use a probabilistic approach to iteratively generate candidate patterns, evaluate their utility, and refine the probability distribution to converge towards optimal solutions.

## Version History & Improvements

This repository contains five versions of the algorithm, each building upon the previous one with specific optimizations.

### 1. TKUSP (Base Algorithm)
The baseline implementation of the Cross-Entropy method for Top-K Utility Sequential Pattern mining.
*   **Core Mechanism**: Iterative learning loop using a Probability Matrix (PM).
*   **Initialization**: Uniform probability distribution.
*   **Pruning**: Basic pruning of items based on the current minimum utility threshold.
*   **Sampling**: Generates sequences based on the current PM.

### 2. TKUSP_V1 (Enhanced Convergence)
Introduces critical mechanisms to improve convergence speed and solution quality.
*   **Early Stopping**:
    *   **Stagnation Detection**: Stops if the $k$-th best utility doesn't improve for $X$ iterations.
    *   **Stabilization Detection**: Stops if the Probability Matrix variation is below a threshold $\epsilon$.
*   **Adaptive Sequence Length**: Instead of uniform random lengths, it learns the optimal sequence length distribution from the elite samples.
*   **Smoothing Mutation**: Dynamically balances exploration (random generation) and exploitation (PM-based generation) using a smoothing factor $\alpha$ derived from elite diversity.

### 3. TKUSP_V2 (Genetic Crossover / Fusion)
Adds a genetic algorithm component to the generation process.
*   **Fusion-Based Exploration**: A portion of the sample (e.g., 10%) is generated by **fusing** (crossing over) pairs of sequences from the *previous iteration's* elite set.
*   **Mechanism**: Concatenates itemsets from two parent sequences to create new candidates, promoting the combination of high-utility sub-patterns.

### 4. TKUSP_V3 (Refined Fusion)
Improves the fusion strategy introduced in V2.
*   **Current-Generation Fusion**: Instead of relying only on the previous elite, it selects candidates for fusion from the *current iteration's* freshly generated sample (both random and PM-based).
*   **Benefit**: Allows for more immediate exploitation of promising new patterns found in the current step.

### 5. TKUSP_V4 (Advanced Convergence)
Further refines the termination logic.
*   **Stagnation-Based Early Stopping**: Explicitly monitors the utility of the $k$-th pattern. If this value stagnates for a defined number of iterations, the algorithm terminates early, saving computation time when no further improvements are likely.

## Compilation and Execution

### Compilation
To compile the project and create the executable JAR file, run the following commands from the root of the repository:

```bash
# 1) Compile all sources into the 'out' directory
mkdir -p out
find src -name '*.java' > sources.txt
javac -d out @sources.txt

# 2) Create the manifest file
echo "Main-Class: Main" > manifest.txt

# 3) Package into an executable JAR
jar cfm tkhuspm.jar manifest.txt -C out .
```

### Execution
To run the algorithm, use the generated JAR file.

**Example Command:**

```bash
java -jar tkhuspm.jar -V 1 -d data/BIBLE.txt -k 100 -N 2000 -s 123 \
  -r 0.3 -i 100 -l 10 -o output/SIGN.txt
```

**Parameters:**
*   `-V`: Algorithm version (0=TKUSP, 1=TKUSP_V1, 2=TKUSP_V2, 3=TKUSP_V3, 4=TKUSP_V4)
*   `-d`: Path to the input dataset file
*   `-k`: Number of top patterns to find (k)
*   `-N`: Sample size per iteration
*   `-s`: Random seed (for reproducibility)
*   `-r`: Elite ratio (rho), percentage of best samples to keep
*   `-i`: Maximum number of iterations
*   `-l`: Maximum sequence length
*   `-o`: Output file path
